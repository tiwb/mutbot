# 消息输入框重设计 设计规范

**状态**：✅ 已完成
**日期**：2026-02-26
**类型**：功能设计

## 1. 背景

当前消息输入框（`ChatInput.tsx`）采用左右布局：左侧 textarea，右侧纵向排列 Send/Stop 按钮。存在以下不足：

- **布局松散**：按钮与输入框并排，视觉上不够紧凑统一
- **功能区缺失**：没有图片插入、文件上传、表情等功能的预留位置
- **发送方式固定**：硬编码为 Ctrl+Enter 发送，无法切换为 Enter 发送
- **按钮样式**：圆角仅 2px，与输入框的 8px 圆角不协调

## 2. 设计方案

### 2.1 整体布局

将输入框重构为**两行布局**，外部由统一的圆角容器包裹：

```
┌─────────────────────────────────────────────────────┐
│  textarea（自适应高度，无边框）                        │
│                                                     │
├─────────────────────────────────────────────────────┤
│  [📎] [🖼️] [😀] ...         [Stop] [Send ▾]       │
│  ← 功能按钮区（左侧）      操作按钮区（右侧）→      │
└─────────────────────────────────────────────────────┘
```

- **外层容器** `.chat-input-container`：统一圆角（8px）、背景色、边框
- **第一行**：textarea，无独立边框，背景透明融入容器
- **第二行** `.chat-input-toolbar`：功能区，flex 布局，左右分区
  - 左侧 `.toolbar-left`：功能按钮（图片、文件、表情），当前仅预留占位
  - 右侧 `.toolbar-right`：Stop 按钮 + Send 按钮（含下拉菜单）

### 2.2 发送按钮与下拉菜单

Send 按钮右侧带下拉箭头，点击箭头弹出发送方式选择菜单：

```
┌──────────────┐
│  Send   │ ▾ │   ← 点击左侧发送，点击 ▾ 展开菜单
└──────────────┘
      ┌─────────────────────┐
      │ ✓ 按 Enter 发送     │
      │   按 Ctrl+Enter 发送 │
      └─────────────────────┘
```

- **复合按钮**：左侧为发送区域，右侧为下拉箭头，两者视觉上为一体
- **下拉菜单**：向上弹出（输入框在页面底部），圆角，阴影
- **持久化**：发送方式偏好存储到 `localStorage`，key 为 `chatInput.sendMode`
- **默认值**：`enter`（按 Enter 发送）

### 2.3 键盘行为

| 发送方式 | 发送快捷键 | 换行快捷键 |
|---------|-----------|-----------|
| 按 Enter 发送 | `Enter` | `Shift+Enter` |
| 按 Ctrl+Enter 发送 | `Ctrl+Enter` / `Cmd+Enter` | `Enter` |

- placeholder 文本根据当前发送方式动态变化：
  - Enter 模式：`"输入消息... (Shift+Enter 换行)"`
  - Ctrl+Enter 模式：`"输入消息... (Ctrl+Enter 发送)"`

### 2.4 功能按钮预留（左侧）

当前阶段左侧功能区渲染 **disabled 图标按钮**作为占位，不实现具体功能：

- **附件按钮** 📎：上传文件（预留）
- **图片按钮** 🖼️：插入图片（预留）
- **表情按钮** 😀：表情选择器（预留）

占位按钮样式：图标按钮，disabled 状态，hover 显示 "即将支持" tooltip，统一 24x24 尺寸。

### 2.5 Stop 与 Send 按钮样式

- 圆角：6px（与容器 8px 协调但不等大）
- Stop 按钮：仅在 `isBusy` 时显示/启用
- Send 按钮：主色调蓝色，disabled 时降低透明度
- 按钮高度：28px，紧凑风格

### 2.6 聚焦与交互

- 点击容器任意位置（非按钮区域）聚焦 textarea
- textarea 聚焦时容器显示高亮边框（`var(--accent)`）
- 下拉菜单打开时，点击外部区域关闭

## 3. 设计决策

| 项目 | 决策 |
|------|------|
| 预留功能按钮 | 渲染为 disabled 图标按钮，hover 显示 "即将支持" |
| 发送方式默认值 | "按 Enter 发送"，localStorage 记住用户选择 |
| textarea 高度 | 自适应，最小 1 行，最大 8 行，超出滚动 |
| 按钮文字 | 中文："发送" / "停止" |

## 4. 实施步骤清单

### 阶段一：组件结构重构 [✅ 已完成]
- [x] **Task 1.1**: 重构 ChatInput.tsx 布局
  - [x] 创建外层容器 `.chat-input-container`
  - [x] textarea 移入容器第一行，去除独立边框
  - [x] 创建工具栏第二行 `.chat-input-toolbar`
  - [x] 左侧预留功能按钮区域（disabled 图标按钮）
  - [x] 右侧放置 Stop + Send 按钮
  - 状态：✅ 已完成

- [x] **Task 1.2**: 实现发送方式切换
  - [x] 创建 Send 复合按钮组件（发送 + 下拉箭头）
  - [x] 实现下拉菜单（向上弹出）
  - [x] localStorage 持久化发送方式偏好
  - [x] 键盘事件处理根据发送方式切换逻辑
  - [x] 动态 placeholder 文本
  - 状态：✅ 已完成

### 阶段二：样式与交互 [✅ 已完成]
- [x] **Task 2.1**: 更新 CSS 样式
  - [x] 容器统一圆角、边框、背景
  - [x] textarea 无边框、背景透明
  - [x] 工具栏 flex 布局样式
  - [x] 按钮圆角 6px 样式
  - [x] 聚焦高亮边框
  - [x] 下拉菜单样式（向上弹出、阴影、圆角）
  - 状态：✅ 已完成

- [x] **Task 2.2**: 预留功能按钮
  - [x] 添加附件、图片、表情图标按钮（disabled）
  - [x] hover tooltip "即将支持"
  - 状态：✅ 已完成

### 阶段三：优化 [✅ 已完成]
- [x] **Task 3.1**: textarea 自适应高度
  - [x] 实现 auto-grow 逻辑
  - [x] 设置最小/最大高度（1行~8行）
  - 状态：✅ 已完成

## 5. 测试验证

### 功能测试
- [ ] Enter 发送模式：Enter 发送、Shift+Enter 换行
- [ ] Ctrl+Enter 发送模式：Ctrl+Enter 发送、Enter 换行
- [ ] 发送方式切换后刷新页面，偏好保持
- [ ] 下拉菜单打开/关闭交互
- [ ] disabled 状态下所有按钮和输入不可操作
- [ ] isBusy 时 Stop 按钮可用，Send 按钮状态正确

### 视觉验证
- [ ] 容器圆角统一
- [ ] 聚焦高亮边框
- [ ] 按钮圆角一致
- [ ] 下拉菜单定位正确（向上弹出）
- [ ] 预留按钮 disabled 样式
